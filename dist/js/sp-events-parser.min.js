var spEventsParser={parseEvents:function(events,start,end){for(var full=[],i=0;i<events.length;i++)full=full.concat(this.parseEvent(events[i],start,end));return full},formatString:function(str){var arr=str.split("'");return str=arr.join(""),arr=str.split('"'),str=arr.join(""),arr=str.split("="),(str=arr.join(" ")).trim(),str.split(" ")},parseDate:function(date,allDay){if("string"==typeof date){if(!allDay)return new Date(date);if(date.lastIndexOf("Z")==date.length-1){var dt=date.substring(0,date.length-1);return new Date(dt)}}return date},parseEvent:function(e,start,end){if(e.fRecurrence){start=start||this.parseDate(e.EventDate,e.fAllDayEvent),end=end||this.parseDate(e.EndDate,e.fAllDayEvent);var er=[],wd=["su","mo","tu","we","th","fr","sa"],wom=["first","second","third","fourth"],rTotal=0,total=0,str,arr;if(-1!=e.RecurrenceData.indexOf("<repeatInstances>")&&(rTotal=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<repeatInstances>")+17),rTotal=parseInt(rTotal.substring(0,rTotal.indexOf("<")))),-1!=e.RecurrenceData.indexOf("<daily "))if(str=(str=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<daily "))).substring(7,str.indexOf("/>")-1),-1!=(arr=this.formatString(str)).indexOf("dayFrequency"))for(var frequency=parseInt(arr[arr.indexOf("dayFrequency")+1]),loop=!0,init=this.parseDate(e.EventDate,e.fAllDayEvent);loop;){var ed,ni;if(total++,new Date(init).getTime()>=start.getTime())(ed=new Date(init)).setSeconds(ed.getSeconds()+e.Duration),(ni=this.cloneObj(e)).EventDate=new Date(init),ni.EndDate=ed,ni.fRecurrence=!1,ni.Id=e.Id,ni.ID=ni.Id,er.push(ni);init.setDate(init.getDate()+frequency),(new Date(init)>end||rTotal>0&&rTotal<=total)&&(loop=!1)}else-1!=arr.indexOf("weekday")&&(e.RecurrenceData=e.RecurrenceData+"<weekly mo='TRUE' tu='TRUE' we='TRUE' th='TRUE' fr='TRUE' weekFrequency='1' />");if(-1!=e.RecurrenceData.indexOf("<weekly ")){var str;str=(str=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<weekly "))).substring(8,str.indexOf("/>")-1);for(var arr=this.formatString(str),frequency=parseInt(arr[arr.indexOf("weekFrequency")+1]),loop=!0,init,initDay=(init=this.parseDate(e.EventDate,e.fAllDayEvent)).getDay();loop;){for(var i=initDay;i<7;i++){var nd,ed,ni;if(-1!=arr.indexOf(wd[i])&&(rTotal>total||0==rTotal))if(total++,new Date(init).getTime()>=start.getTime())(nd=new Date(init)).setDate(nd.getDate()+(i-initDay)),(ed=new Date(nd)).setSeconds(ed.getSeconds()+e.Duration),(ni=this.cloneObj(e)).EventDate=new Date(nd),ni.EndDate=ed,ni.fRecurrence=!1,ni.Id=e.Id,ni.ID=ni.Id,er.push(ni)}init.setDate(init.getDate()+(7*frequency-initDay)),initDay=0,(new Date(init)>end||rTotal>0&&rTotal<=total)&&(loop=!1)}}if(-1!=e.RecurrenceData.indexOf("<monthly ")){var str;str=(str=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<monthly "))).substring(9,str.indexOf("/>")-1);for(var arr=this.formatString(str),frequency=parseInt(arr[arr.indexOf("monthFrequency")+1]),loop=!0,init=this.parseDate(e.EventDate,e.fAllDayEvent),day=parseInt(arr[arr.indexOf("day")+1]);loop;){var nd,ed,ni;if(total++,new Date(init).getTime()>=start.getTime())if((nd=new Date(init)).setDate(day),nd.getMonth()==init.getMonth())(ed=new Date(nd)).setSeconds(ed.getSeconds()+e.Duration),(ni=this.cloneObj(e)).EventDate=new Date(nd),ni.EndDate=ed,ni.fRecurrence=!1,ni.Id=e.Id,ni.ID=ni.Id,er.push(ni);init.setMonth(init.getMonth()+frequency),(new Date(init)>end||rTotal>0&&rTotal<=total)&&(loop=!1)}}if(-1!=e.RecurrenceData.indexOf("<monthlyByDay ")){var str;str=(str=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<monthlyByDay "))).substring(14,str.indexOf("/>")-1);for(var arr=this.formatString(str),frequency=parseInt(arr[arr.indexOf("monthFrequency")+1]),loop=!0,init=this.parseDate(e.EventDate,e.fAllDayEvent),weekdayOfMonth=arr[arr.indexOf("weekdayOfMonth")+1],temp=new Date;loop;){if(total++,new Date(init).getTime()>=start.getTime()){var nd,ed,ni;if((nd=new Date(init)).setDate(1),-1!=arr.indexOf("weekday"))if(0==nd.getDay()?nd.setDate(nd.getDate()+1):6==nd.getDay()&&nd.setDate(nd.getDate()+2),"last"==weekdayOfMonth){for(;nd.getMonth()==init.getMonth();)temp=new Date(nd),5==nd.getDay()?nd.setDate(nd.getDate()+3):nd.setDate(nd.getDate()+1);nd=new Date(temp)}else for(var i=0;i<wom.indexOf(weekdayOfMonth);i++)5==nd.getDay()?nd.setDate(nd.getDate()+3):nd.setDate(nd.getDate()+1);else if(-1!=arr.indexOf("weekend_day"))if(0!=nd.getDay()&&6!=nd.getDay()&&nd.setDate(nd.getDate()+(6-nd.getDay())),"last"==weekdayOfMonth){for(;nd.getMonth()==init.getMonth();)temp=new Date(nd),0==nd.getDay()?nd.setDate(nd.getDate()+6):nd.setDate(nd.getDate()+1);nd=new Date(temp)}else for(var i=0;i<wom.indexOf(weekdayOfMonth);i++)0==nd.getDay()?nd.setDate(nd.getDate()+6):nd.setDate(nd.getDate()+1);else if(-1!=arr.indexOf("day")){var nd;if("last"==weekdayOfMonth)(nd=nd.setMonth(nd.getMonth()+1)).setDate(0);else nd.setDate(nd.getDate()+wom.indexOf(weekdayOfMonth))}else{for(var i=0;i<wd.length;i++)-1!=arr.indexOf(wd[i])&&(nd.getDay()>i?nd.setDate(nd.getDate()+(7-(nd.getDay()-i))):nd.setDate(nd.getDate()+(i-nd.getDay())));if("last"==weekdayOfMonth){for(;nd.getMonth()==init.getMonth();)temp=new Date(nd),nd.setDate(nd.getDate()+7);nd=new Date(temp)}else for(var i=0;i<wom.indexOf(weekdayOfMonth);i++)nd.setDate(nd.getDate()+7)}if(nd.getMonth()==init.getMonth())(ed=new Date(nd)).setSeconds(ed.getSeconds()+e.Duration),(ni=this.cloneObj(e)).EventDate=new Date(nd),ni.EndDate=ed,ni.fRecurrence=!1,ni.Id=e.Id,ni.ID=ni.Id,er.push(ni)}init.setMonth(init.getMonth()+frequency),(new Date(init)>end||rTotal>0&&rTotal<=total)&&(loop=!1)}}if(-1!=e.RecurrenceData.indexOf("<yearly ")){var str;str=(str=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<yearly "))).substring(8,str.indexOf("/>")-1);for(var arr=this.formatString(str),frequency=parseInt(arr[arr.indexOf("yearFrequency")+1]),loop=!0,init=this.parseDate(e.EventDate,e.fAllDayEvent),month=parseInt(arr[arr.indexOf("month")+1])-1,day=parseInt(arr[arr.indexOf("day")+1]);loop;){var nd,ed,ni;if((nd=new Date(init)).setMonth(month),nd.setDate(day),new Date(init).getTime()<=nd.getTime())if(total++,new Date(init).getTime()>=start.getTime())(ed=new Date(nd)).setSeconds(ed.getSeconds()+e.Duration),(ni=this.cloneObj(e)).EventDate=new Date(nd),ni.EndDate=ed,ni.fRecurrence=!1,ni.Id=e.Id,ni.ID=ni.Id,er.push(ni);init.setFullYear(init.getFullYear()+frequency),(new Date(init)>end||rTotal>0&&rTotal<=total)&&(loop=!1)}}if(-1!=e.RecurrenceData.indexOf("<yearlyByDay ")){var str;str=(str=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<yearlyByDay "))).substring(13,str.indexOf("/>")-1);for(var arr=this.formatString(str),frequency=parseInt(arr[arr.indexOf("yearFrequency")+1]),loop=!0,init=this.parseDate(e.EventDate,e.fAllDayEvent),month=parseInt(arr[arr.indexOf("month")+1])-1,weekdayOfMonth=arr[arr.indexOf("weekdayOfMonth")+1],day=0,i=0;i<wd.length;i++)-1!=arr.indexOf(wd[i])&&"true"==arr[arr.indexOf(wd[i])+1].toLowerCase()&&(day=i);for(;loop;){var nd;if((nd=new Date(init)).setMonth(month),new Date(init).getTime()<=nd.getTime()&&(total++,new Date(init).getTime()>=start.getTime())){nd.setDate(1);var dayOfMonth=nd.getDay(),ed,ni;if(day<dayOfMonth?nd.setDate(nd.getDate()+(7-dayOfMonth+day)):nd.setDate(nd.getDate()+(day-dayOfMonth)),"last"==weekdayOfMonth)for(var temp=new Date(nd);temp.getMonth()==month;)nd=new Date(temp),temp.setDate(temp.getDate()+7);else nd.setDate(nd.getDate()+7*wom.indexOf(weekdayOfMonth));if(nd.getMonth()==month)(ed=new Date(nd)).setSeconds(ed.getSeconds()+e.Duration),(ni=this.cloneObj(e)).EventDate=new Date(nd),ni.EndDate=ed,ni.fRecurrence=!1,ni.Id=e.Id,ni.ID=ni.Id,er.push(ni)}init.setFullYear(init.getFullYear()+frequency),init.setMonth(month),init.setDate(1),(new Date(init)>end||rTotal>0&&rTotal<=total)&&(loop=!1)}}return er}return e.EventDate=new Date(this.parseDate(e.EventDate,e.fAllDayEvent)),e.EndDate=new Date(this.parseDate(e.EndDate,e.fAllDayEvent)),[e]},cloneObj:function(obj){var copy;if(null==obj||"object"!=typeof obj)return obj;if(obj instanceof Date)return(copy=new Date).setTime(obj.getTime()),copy;if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;i<len;i++)copy[i]=this.cloneObj(obj[i]);return copy}if(obj instanceof Object){for(var attr in copy={},obj)obj.hasOwnProperty(attr)&&(copy[attr]=this.cloneObj(obj[attr]));return copy}throw new Error("Unable to copy obj! Its type isn't supported.")}};