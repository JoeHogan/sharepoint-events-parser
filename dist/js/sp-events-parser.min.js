var spEventsParser={parseEvents:function(e,t,a){for(var n=[],r=0;r<e.length;r++)n=n.concat(this.parseEvent(e[r],t,a));return n},formatString:function(e){var t=e.split("'");return e=t.join(""),t=e.split('"'),e=t.join(""),t=e.split("="),e=t.join(" "),e.trim(),e.split(" ")},parseDate:function(e,t){if("string"==typeof e){if(!t)return new Date(e);if(e.lastIndexOf("Z")==e.length-1){var a=e.substring(0,e.length-1);return new Date(a)}}return e},parseEvent:function(e,t,a){if(e.fRecurrence){t=t||Date.parse(this.parseDate(e.EventDate,e.fAllDayEvent)),a=a||Date.parse(this.parseDate(e.EndDate,e.fAllDayEvent));var n=[],r=["su","mo","tu","we","th","fr","sa"],D=["first","second","third","fourth"],s=0,i=0;if(-1!=e.RecurrenceData.indexOf("<repeatInstances>")&&(s=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<repeatInstances>")+17),s=parseInt(s.substring(0,s.indexOf("<")))),-1!=e.RecurrenceData.indexOf("<daily ")){var f=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<daily "));f=f.substring(7,f.indexOf("/>")-1);var o=this.formatString(f);if(-1!=o.indexOf("dayFrequency"))for(var c=parseInt(o[o.indexOf("dayFrequency")+1]),d=!0,u=this.parseDate(e.EventDate,e.fAllDayEvent);d;){if(i++,Date.parse(new Date(u))>=t){var g=new Date(u);g.setSeconds(g.getSeconds()+e.Duration);var l=this.cloneObj(e);l.EventDate=new Date(u),l.EndDate=g,l.fRecurrence=!1,l.Id=e.Id,l.ID=l.Id,n.push(l)}u.setDate(u.getDate()+c),(Date.parse(new Date(u))>a||s>0&&i>=s)&&(d=!1)}else-1!=o.indexOf("weekday")&&(e.RecurrenceData=e.RecurrenceData+"<weekly mo='TRUE' tu='TRUE' we='TRUE' th='TRUE' fr='TRUE' weekFrequency='1' />")}if(-1!=e.RecurrenceData.indexOf("<weekly ")){var f=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<weekly "));f=f.substring(8,f.indexOf("/>")-1);for(var o=this.formatString(f),c=parseInt(o[o.indexOf("weekFrequency")+1]),d=!0,u=this.parseDate(e.EventDate,e.fAllDayEvent),y=u.getDay();d;){i++;for(var v=y;7>v;v++)if(Date.parse(new Date(u))>=t&&-1!=o.indexOf(r[v])){var h=new Date(u);h.setDate(h.getDate()+(v-y));var g=new Date(h);g.setSeconds(g.getSeconds()+e.Duration);var l=this.cloneObj(e);l.EventDate=new Date(h),l.EndDate=g,l.fRecurrence=!1,l.Id=e.Id,l.ID=l.Id,n.push(l)}u.setDate(u.getDate()+(7*c-y)),y=0,(Date.parse(new Date(u))>a||s>0&&i>=s)&&(d=!1)}}if(-1!=e.RecurrenceData.indexOf("<monthly ")){var f=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<monthly "));f=f.substring(9,f.indexOf("/>")-1);for(var o=this.formatString(f),c=parseInt(o[o.indexOf("monthFrequency")+1]),d=!0,u=this.parseDate(e.EventDate,e.fAllDayEvent),O=parseInt(o[o.indexOf("day")+1]);d;){if(i++,Date.parse(new Date(u))>=t){var g=new Date(u);g.setSeconds(g.getSeconds()+e.Duration);var l=this.cloneObj(e);l.EventDate=new Date(u),l.EndDate=g,l.fRecurrence=!1,l.Id=e.Id,l.ID=l.Id,n.push(l)}u.setMonth(u.getMonth()+c),(Date.parse(new Date(u))>a||s>0&&i>=s)&&(d=!1)}}if(-1!=e.RecurrenceData.indexOf("<monthlyByDay ")){var f=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<monthlyByDay "));f=f.substring(14,f.indexOf("/>")-1);for(var o=this.formatString(f),c=parseInt(o[o.indexOf("monthFrequency")+1]),d=!0,u=this.parseDate(e.EventDate,e.fAllDayEvent),p=o[o.indexOf("weekdayOfMonth")+1],w=new Date;d;){if(i++,Date.parse(new Date(u))>=t){var h=new Date(u);if(h.setDate(1),-1!=o.indexOf("weekday"))if(0==h.getDay()?h.setDate(h.getDate()+1):6==h.getDay()&&h.setDate(h.getDate()+2),"last"==p){for(;h.getMonth()==u.getMonth();)w=new Date(h),h.setDate(5==h.getDay()?h.getDate()+3:h.getDate()+1);h=new Date(w)}else for(var v=0;v<D.indexOf(p);v++)h.setDate(5==h.getDay()?h.getDate()+3:h.getDate()+1);else if(-1!=o.indexOf("weekend_day"))if(0!=h.getDay()&&6!=h.getDay()&&h.setDate(h.getDate()+(6-h.getDay())),"last"==p){for(;h.getMonth()==u.getMonth();)w=new Date(h),h.setDate(0==h.getDay()?h.getDate()+6:h.getDate()+1);h=new Date(w)}else for(var v=0;v<D.indexOf(p);v++)h.setDate(0==h.getDay()?h.getDate()+6:h.getDate()+1);else if(-1!=o.indexOf("day"))if("last"==p){var h=h.setMonth(h.getMonth()+1);h.setDate(0)}else h.setDate(h.getDate()+D.indexOf(p));else{for(var v=0;v<r.length;v++)-1!=o.indexOf(r[v])&&h.setDate(h.getDate()>v?h.getDate()+(7-(h.getDay()-v)):h.getDate()+(v-h.getDay()));if("last"==p){for(;h.getMonth()==u.getMonth();)w=new Date(h),h.setDate(h.getDate()+7);h=new Date(w)}else for(var v=0;v<D.indexOf(p);v++)h.setDate(h.getDate()+7)}if(h.getMonth()==u.getMonth()){var g=new Date(h);g.setSeconds(g.getSeconds()+e.Duration);var l=this.cloneObj(e);l.EventDate=new Date(h),l.EndDate=g,l.fRecurrence=!1,l.Id=e.Id,l.ID=l.Id,n.push(l)}}u.setMonth(u.getMonth()+c),(Date.parse(new Date(u))>a||s>0&&i>=s)&&(d=!1)}}if(-1!=e.RecurrenceData.indexOf("<yearly ")){var f=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<yearly "));f=f.substring(8,f.indexOf("/>")-1);for(var o=this.formatString(f),c=parseInt(o[o.indexOf("yearFrequency")+1]),d=!0,u=this.parseDate(e.EventDate,e.fAllDayEvent),x=parseInt(o[o.indexOf("month")+1])-1,O=parseInt(o[o.indexOf("day")+1]);d;){if(i++,Date.parse(new Date(u))>=t){var g=new Date(u);g.setSeconds(g.getSeconds()+e.Duration);var l=this.cloneObj(e);l.EventDate=new Date(u),l.EndDate=g,l.fRecurrence=!1,l.Id=e.Id,l.ID=l.Id,n.push(l)}u.setFullYear(u.getFullYear()+c),(Date.parse(new Date(u))>a||s>0&&i>=s)&&(d=!1)}}if(-1!=e.RecurrenceData.indexOf("<yearlyByDay ")){var f=e.RecurrenceData.substring(e.RecurrenceData.indexOf("<yearlyByDay "));f=f.substring(13,f.indexOf("/>")-1);for(var o=this.formatString(f),c=parseInt(o[o.indexOf("yearFrequency")+1]),d=!0,u=this.parseDate(e.EventDate,e.fAllDayEvent),x=parseInt(o[o.indexOf("month")+1])-1,p=o[o.indexOf("weekdayOfMonth")+1],O=0,v=0;v<r.length;v++)-1!=o.indexOf(r[v])&&"true"==o[o.indexOf(r[v])+1].toLowerCase()&&(O=v);for(;d;){if(i++,Date.parse(new Date(u))>=t){var h=new Date(u);h.setMonth(x),h.setDate(1);var E=h.getDay();if(h.setDate(E>O?E+(7-E)+O:E+(O-E)),"last"==p)for(var w=new Date(h);w.getMonth()==x;)h=new Date(w),w.setDate(w.getDate()+7);else h.setDate(h.getDate()+7*D.indexOf(p));if(h.getMonth()==x){var g=new Date(h);g.setSeconds(g.getSeconds()+e.Duration);var l=this.cloneObj(e);l.EventDate=new Date(h),l.EndDate=g,l.fRecurrence=!1,l.Id=e.Id,l.ID=l.Id,n.push(l)}}u.setFullYear(u.getFullYear()+c),(Date.parse(new Date(u))>a||s>0&&i>=s)&&(d=!1)}}return n}return e.EventDate=new Date(this.parseDate(e.EventDate,e.fAllDayEvent)),e.EndDate=new Date(this.parseDate(e.EndDate,e.fAllDayEvent)),[e]},cloneObj:function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var a=0,n=e.length;n>a;a++)t[a]=this.cloneObj(e[a]);return t}if(e instanceof Object){t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=this.cloneObj(e[r]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}};